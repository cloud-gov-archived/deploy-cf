- type: replace
  path: /releases/-
  value:
    name: efs-volume
    version: latest

- type: replace
  path: /instance_groups/name=diego-cell/jobs/-
  value:
    name: efsdriver
    release: efs-volume
    properties:
      efsdriver:
        tls:
          ca_cert: ((efs_ca.certificate))
          server_cert: ((efsdriver_cert.certificate))
          server_key: ((efsdriver_cert.private_key))
          client_cert: ((efsdriver_client_cert.certificate))
          client_key: ((efsdriver_client_cert.private_key))

- type: replace
  path: /variables/-
  value:
    name: efs-broker-password
    type: password

- type: replace
  path: /variables/-
  value:
    name: efs-broker-database-password
    type: password

- type: replace
  path: /variables/-
  value:
    name: efs_ca
    options:
      common_name: efs-ca
      is_ca: true
    type: certificate

- type: replace
  path: /variables/-
  value:
    name: efsdriver_cert
    options:
      ca: efs_ca
      common_name: 127.0.0.1
      alternative_names:
      - 127.0.0.1
      extended_key_usage:
      - server_auth
    type: certificate

- type: replace
  path: /variables/-
  value:
    name: efsdriver_client_cert
    options:
      ca: efs_ca
      common_name: efs-client
      extended_key_usage:
      - client_auth
    type: certificate

- type: replace
  path: /instance_groups/name=api/jobs/name=cloud_controller_ng/properties/cc/volume_services_enabled?
  value: true

- type: replace
  path: /instance_groups/name=cc-worker/jobs/name=cloud_controller_worker/properties/cc/volume_services_enabled?
  value: true

- type: replace
  path: /instance_groups/name=scheduler/jobs/name=cloud_controller_clock/properties/cc/volume_services_enabled?
  value: true

# - type: replace
#   path: /instance_groups/name=database/jobs/name=pxc-mysql/properties/seeded_databases/-
#   value:
#     name: efs-broker
#     password: ((efs-broker-database-password))
#     username: efs-broker

- type: replace
  path: /instance_groups/-
  value:
    name: efsbroker
    azs:
    - z1
    instances: 1
    vm_type: t3.small
    stemcell: default
    networks:
      - name: default
    jobs:
    - name: efsbroker
      release: efs-volume
      properties:
        efsbroker:
          credhub:
            url: ((credhub_url))
            ca:  ((uaa_ssl.ca))
            clientid: ((credhub_id))
            clientsecret: ((credhub_secret))
          uaa:
            ca: ((uaa_ssl.ca))
          listen-addr: 0.0.0.0:8999
          service-name: efs
          service-id: d0406c23-c33f-4f10-804b-9083a486d857
          db_driver: postgres
          db_username: efs-broker
          db_password: ((efs-broker-database-password))
          db_hostname: ((external_efsbroker_database_address))
          db_port: 5432
          db_name: efs-broker
          release_level_backup: true
          username: admin
          password: ((efs-broker-password))
          aws-region: ((aws_region))
          aws-access-key-id: ((efs_aws_key))
          aws-secret-access-key: ((efs_aws_secret))
          aws-subnet-ids: ((aws-subnet-ids))
          aws-security-groups: ((aws-security-groups))
          aws-azs: ((aws-azs))
    - name: route_registrar
      release: routing
      properties:
        nats:
          tls:
            client_cert: ((/bosh/cf-development/nats_client_cert.certificate))
            client_key: ((/bosh/cf-development/nats_client_cert.private_key))
            enabled: true
        route_registrar:
          routes:
          - name: efs-broker
            port: 8999
            registration_interval: 20s
            tags:
              component: efs-broker
            uris:
            - efs-broker.((system_domain))

- type: replace
  path: /instance_groups/name=diego-cell/jobs/name=mapfs?
  value:
    name: mapfs
    release: mapfs

- type: replace
  path: /releases/name=mapfs?
  value:
    name: mapfs
    version: latest